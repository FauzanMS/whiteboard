(this["webpackJsonpreact-fabricjs-whiteboard"]=this["webpackJsonpreact-fabricjs-whiteboard"]||[]).push([[0],{25:function(e,t,n){e.exports={whiteboard:"WhiteBoard_whiteboard__3PMpc",toolbar:"WhiteBoard_toolbar__3kTEu",dropdownButton:"WhiteBoard_dropdownButton__XgpWD",uploadDropdown:"WhiteBoard_uploadDropdown__1u8Bg",dropdownContent:"WhiteBoard_dropdownContent__oAziG"}},27:function(e,t,n){e.exports={pdfReader:"PdfReader_pdfReader__3P8qq",fileContainer:"PdfReader_fileContainer__2gJs-",pageInfo:"PdfReader_pageInfo__27lCr"}},41:function(e,t){},43:function(e,t,n){e.exports={app:"app_app__3mk8F"}},48:function(e,t,n){},53:function(e,t){},54:function(e,t){},55:function(e,t){},57:function(e,t){},58:function(e,t){},59:function(e,t){},60:function(e,t){},61:function(e,t){},64:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),c=n(42),a=n.n(c),i=n(11),u=n(36),s=n(21),l=n(16),d=n(39),f=n(38),b=n(27),j=n.n(b),p=n(5);f.a.GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(f.a.version,"/pdf.worker.js");var g=function(e){var t=e.fileReaderInfo,n=e.updateFileReaderInfo,r=e.savePage;function o(e){n({currentPageNumber:t.currentPageNumber+e})}return Object(p.jsxs)("div",{className:j.a.pdfReader,children:[Object(p.jsx)("div",{className:j.a.fileContainer,children:Object(p.jsx)(d.a,{className:j.a.document,file:t.file,onLoadSuccess:function(e){var t=e.numPages;n({totalPages:t})},onLoadProgress:function(e){var t=e.loaded,n=e.total;return console.log("Loading a document: "+t/n*100+"%")},children:Object(p.jsx)(d.b,{className:"import-pdf-page",onRenderSuccess:function(){var e=document.querySelector(".import-pdf-page canvas").toDataURL();n({currentPage:e})},pageNumber:t.currentPageNumber})})}),Object(p.jsxs)("div",{className:j.a.pageInfo,children:[Object(p.jsxs)("span",{children:["Page ",t.currentPageNumber," of ",t.totalPages||"--"]}),Object(p.jsx)("button",{type:"button",disabled:t.currentPageNumber>=t.totalPages,onClick:function(){o(1),r()},children:"Next"})]})]})},h=n(37),m=n.p+"static/media/remove.30a74efc.svg",O=function(e){return"eraser"===e.type?m:""},v=n.p+"static/media/select.ad97be73.svg",x=n.p+"static/media/eraser.6834b010.svg",C=n.p+"static/media/text.abecf614.svg",w=n.p+"static/media/rectangle.55957e34.svg",E=n.p+"static/media/line.8231e012.svg",R=n.p+"static/media/ellipse.8c29c164.svg",P=n.p+"static/media/triangle.58a0a70e.svg",y=n.p+"static/media/pencil.eda8d85b.svg",N=n.p+"static/media/delete.f634ca67.svg",A=n(25),k=n.n(A),I=function(e){var t,n,c=e.aspectRatio,a=void 0===c?4/3:c,d=e.setFiles,f=e.color,b=null,j=!1,m={currentMode:"",currentColor:f,currentWidth:5,fill:!1,group:{}},A={RECTANGLE:"RECTANGLE",TRIANGLE:"TRIANGLE",ELLIPSE:"ELLIPSE",LINE:"LINE",PENCIL:"PENCIL",ERASER:"ERASER"};function I(e){return function(t){m.currentMode===A.ERASER&&e.remove(t.target)}}function L(){j=!1}function M(e){e.off("mouse:down"),e.off("mouse:move"),e.off("mouse:up")}function S(e){A.currentMode!==A.LINE&&(m.currentMode=A.LINE,M(e),e.on("mouse:down",function(e){return function(t){var n=t.e;j=!0;var r=e.getPointer(n);b=new l.fabric.Line([r.x,r.y,r.x,r.y],{strokeWidth:m.currentWidth,stroke:m.currentColor,selectable:!1}),e.add(b),e.requestRenderAll()}}(e)),e.on("mouse:move",function(e){return function(t){var n=t.e;if(j){var r=e.getPointer(n);b.set({x2:r.x,y2:r.y}),b.setCoords(),e.requestRenderAll()}}}(e)),e.on("mouse:up",L),e.selection=!1,e.hoverCursor="auto",e.isDrawingMode=!1,e.getObjects().map((function(e){return e.set({selectable:!1})})),e.discardActiveObject().requestRenderAll())}function _(e){m.currentMode!==A.RECTANGLE&&(m.currentMode=A.RECTANGLE,M(e),e.on("mouse:down",function(e){return function(r){var o=r.e;j=!0;var c=e.getPointer(o);t=c.x,n=c.y,b=new l.fabric.Rect({stroke:m.currentColor,strokeWidth:m.currentWidth,fill:m.fill?m.currentColor:"transparent",left:t,top:n,width:0,height:0,selectable:!1}),e.add(b),b.on("mousedown",(function(t){m.currentMode===A.ERASER&&(console.log("\u522a\u9664",t),e.remove(t.target))}))}}(e)),e.on("mouse:move",function(e){return function(r){var o=r.e;if(j){var c=e.getPointer(o);c.x<t&&b.set("left",c.x),c.y<n&&b.set("top",c.y),b.set({width:Math.abs(c.x-t),height:Math.abs(c.y-n)}),b.setCoords(),e.renderAll()}}}(e)),e.on("mouse:up",L),e.selection=!1,e.hoverCursor="auto",e.isDrawingMode=!1,e.getObjects().map((function(e){return e.set({selectable:!1})})),e.discardActiveObject().requestRenderAll())}function W(e){m.currentMode!==A.ELLIPSE&&(m.currentMode=A.ELLIPSE,M(e),e.on("mouse:down",function(e){return function(r){var o=r.e;j=!0;var c=e.getPointer(o);t=c.x,n=c.y,b=new l.fabric.Ellipse({stroke:m.currentColor,strokeWidth:m.currentWidth,fill:m.fill?m.currentColor:"transparent",left:t,top:n,cornerSize:7,objectCaching:!1,selectable:!1}),e.add(b)}}(e)),e.on("mouse:move",function(e){return function(r){var o=r.e;if(j){var c=e.getPointer(o);c.x<t&&b.set("left",c.x),c.y<n&&b.set("top",c.y),b.set({rx:Math.abs(c.x-t)/2,ry:Math.abs(c.y-n)/2}),b.setCoords(),e.renderAll()}}}(e)),e.on("mouse:up",L),e.selection=!1,e.hoverCursor="auto",e.isDrawingMode=!1,e.getObjects().map((function(e){return e.set({selectable:!1})})),e.discardActiveObject().requestRenderAll())}function D(e){M(e),e.on("mouse:down",function(e){return function(r){var o=r.e;j=!0,m.currentMode=A.TRIANGLE;var c=e.getPointer(o);t=c.x,n=c.y,b=new l.fabric.Triangle({stroke:m.currentColor,strokeWidth:m.currentWidth,fill:m.fill?m.currentColor:"transparent",left:t,top:n,width:0,height:0,selectable:!1}),e.add(b)}}(e)),e.on("mouse:move",function(e){return function(r){var o=r.e;if(j){var c=e.getPointer(o);c.x<t&&b.set("left",c.x),c.y<n&&b.set("top",c.y),b.set({width:Math.abs(c.x-t),height:Math.abs(c.y-n)}),b.setCoords(),e.renderAll()}}}(e)),e.on("mouse:up",L),e.selection=!1,e.hoverCursor="auto",e.isDrawingMode=!1,e.getObjects().map((function(e){return e.set({selectable:!1})})),e.discardActiveObject().requestRenderAll()}var B=Object(r.useState)(null),T=Object(i.a)(B,2),q=T[0],G=T[1],F=Object(r.useState)(5),U=Object(i.a)(F,2),z=U[0],H=U[1],J=Object(r.useState)(!1),X=Object(i.a)(J,2),V=(X[0],X[1],Object(r.useState)({file:"",totalPages:null,currentPageNumber:1,currentPage:""})),Y=Object(i.a)(V,2),Z=Y[0],K=Y[1],Q=Object(r.useRef)(null),$=Object(r.useRef)(null),ee=Object(r.useRef)(null),te=Object(r.useRef)(null);Object(r.useEffect)((function(){if(!q&&Q.current){var e=function(e,t){var n=new l.fabric.Canvas("canvas",{height:t,width:e});return l.fabric.Object.prototype.transparentCorners=!1,l.fabric.Object.prototype.cornerStyle="circle",l.fabric.Object.prototype.borderColor="#4447A9",l.fabric.Object.prototype.cornerColor="#4447A9",l.fabric.Object.prototype.cornerSize=6,l.fabric.Object.prototype.padding=10,l.fabric.Object.prototype.borderDashArray=[5,5],n.on("object:added",(function(e){e.target.on("mousedown",I(n))})),n.on("path:created",(function(e){e.path.on("mousedown",I(n))})),n}($.current.clientWidth,$.current.clientWidth/a);G((function(){return e})),(t=function(e,t){return function(){var n=e.getWidth()/e.getHeight(),r=t.clientWidth,o=r/e.getWidth(),c=e.getZoom()*o;e.setDimensions({width:r,height:r/n}),e.setViewportTransform([c,0,0,c,0,0])}}(e,$.current),new ResizeObserver(t)).observe($.current)}var t}),[Q]),Object(r.useEffect)((function(){if(q){var e=q.getCenter();l.fabric.Image.fromURL(Z.currentPage,(function(t){t.scaleToHeight(q.height),q.setBackgroundImage(t,q.renderAll.bind(q),{top:e.top,left:e.left,originX:"center",originY:"center"}),q.renderAll()}))}}),[Z.currentPage]);var ne=Object(r.useState)([]),re=Object(i.a)(ne,2),oe=re[0],ce=re[1],ae=Object(r.useState)(0),ie=Object(i.a)(ae,2),ue=(ie[0],ie[1],Object(r.useState)([])),se=Object(i.a)(ue,2),le=se[0],de=se[1];function fe(e){de([].concat(Object(s.a)(le),[Q])),Q.current.toBlob((function(t){ce([].concat(Object(s.a)(oe),[t])),e.getObjects().forEach((function(t){t!==e.backgroundImage&&e.remove(t)}))}))}var be=o.a.useState(!1),je=Object(i.a)(be,2),pe=je[0],ge=je[1];function he(e){K(Object(u.a)(Object(u.a)({},Z),e))}return Object(p.jsxs)("div",{ref:$,className:k.a.whiteboard,children:[Object(p.jsxs)("div",{className:k.a.toolbar,children:[Object(p.jsx)("button",{type:"button",onClick:function(){return S(q)},children:Object(p.jsx)("img",{src:E,alt:"line"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return _(q)},children:Object(p.jsx)("img",{src:w,alt:"Rectangle"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return W(q)},children:Object(p.jsx)("img",{src:R,alt:"Ellipse"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return D(q)},children:Object(p.jsx)("img",{src:P,alt:"Triangle"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return function(e){m.currentMode!==A.PENCIL&&(M(e),m.currentMode=A.PENCIL,e.freeDrawingBrush.width=parseInt(m.currentWidth,10)||1,e.isDrawingMode=!0,e.freeDrawingBrush.color=m.currentColor)}(q)},children:Object(p.jsx)("img",{src:y,alt:"Pencil"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return function(e){M(e),e.isDrawingMode=!1;var t=new l.fabric.Textbox("text",{left:100,top:100,fill:m.currentColor,editable:!0});e.add(t),e.renderAll()}(q)},children:Object(p.jsx)("img",{src:C,alt:"Text"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return function(e){m.currentMode="",e.isDrawingMode=!1,M(e),e.getObjects().map((function(e){return e.set({selectable:!0})})),e.hoverCursor="all-scroll"}(q)},children:Object(p.jsx)("img",{src:v,alt:"Selection mode"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return function(e){m.currentMode!==A.ERASER&&(M(e),e.isDrawingMode=!1,m.currentMode=A.ERASER,e.hoverCursor="url(".concat(O({type:"eraser"}),"), default"))}(q)},children:Object(p.jsx)("img",{src:x,alt:"Eraser"})}),Object(p.jsx)("button",{type:"button",onClick:function(){return function(e){e.getObjects().forEach((function(t){t!==e.backgroundImage&&e.remove(t)}))}(q)},children:Object(p.jsx)("img",{src:N,alt:"Delete"})}),Object(p.jsx)("input",{type:"range",min:1,max:20,step:1,value:z,onChange:function(e){var t=parseInt(e.target.value);m.currentWidth=t,q.freeDrawingBrush.width=t,H((function(){return t}))}}),Object(p.jsxs)("div",{className:k.a.uploadDropdown,children:[Object(p.jsx)("input",{ref:ee,accept:"image/*",type:"file",onChange:function(e){var t=new FileReader,n=e.target.files[0];t.addEventListener("load",(function(){l.fabric.Image.fromURL(t.result,(function(e){e.scaleToHeight(q.height),q.add(e)}))})),t.readAsDataURL(n)}}),Object(p.jsx)("input",{ref:te,accept:".pdf",type:"file",onChange:function(e){he({file:e.target.files[0],currentPageNumber:1})}}),Object(p.jsx)("button",{className:k.a.dropdownButton,children:"+Upload"}),Object(p.jsxs)("div",{className:k.a.dropdownContent,children:[Object(p.jsx)("span",{onClick:function(){return ee.current.click()},children:"Image"}),Object(p.jsx)("span",{onClick:function(){te.current.click(),ge(!0)},children:"PDF"})]})]}),Object(p.jsx)("button",{onClick:function(){Q.current.toBlob((function(e){d([].concat(Object(s.a)(oe),[e])),ce([].concat(Object(s.a)(oe),[e]));for(var t=0;t<oe.length;t++)Object(h.saveAs)(oe[t],"im.png");Object(h.saveAs)(e,"im.png")})),q.getObjects().forEach((function(e){e!==q.backgroundImage&&q.remove(e)})),ce([]),he({file:"",currentPageNumber:1})},children:"Save as image"})]}),Object(p.jsx)("canvas",{ref:Q,id:"canvas"}),Object(p.jsx)("div",{children:!pe&&Object(p.jsx)("button",{onClick:function(){return fe(q)},children:"Next"})}),Object(p.jsx)("div",{children:pe&&Object(p.jsx)(g,{savePage:function(){return fe(q)},fileReaderInfo:Z,updateFileReaderInfo:he})})]})},L=n(43),M=n.n(L),S=function(){var e=o.a.useState([]),t=Object(i.a)(e,2),n=(t[0],t[1]);return Object(p.jsx)("div",{className:M.a.app,children:Object(p.jsx)("main",{children:Object(p.jsx)(I,{aspectRatio:4/3,setFiles:n,color:"#ff0019"})})})};n(48);a.a.render(Object(p.jsx)(S,{}),document.getElementById("root"))}},[[64,1,2]]]);
//# sourceMappingURL=main.883b17be.chunk.js.map